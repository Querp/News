{% extends 'main/base.html' %}
{% load static %}
{% load human_date %}

{% block title %}
  Fetched Articles
{% endblock %}

{% block content %}
<div class="settings-header">
    {% comment %} <h3>Settings</h3> {% endcomment %}
    <nav class="settings-nav">
        <button class="show">Configure Auto-Fetch</button>
        <button>Fetch Log</button>
    </nav>

</div>

<div class="settings-main">

    <input class="top-level-radio" id="country-and-category" type="radio" name="top-level-radio" checked>
    <label class="country-and-category-label" for="country-and-category">
        <div class="title">Country & Category</div>
        <div class="body">
            <div class="toggle">
                <input id="country-toggle" type="checkbox" checked>
                <label for="country-toggle">Country</label>
            </div>
            <div class="toggle">
                <input id="category-toggle" type="checkbox">
                <label for="category-toggle">Category</label>
            </div>
        </div>
    </label>

    <input class="top-level-radio" id="source" type="radio" name="top-level-radio">
    <label class="source-label" for="source">Source</label>
</div>

<div class="setting-selectors" id="setting-selectors">
    <div class="country-selector selector" id="country-selector">
        <div class="title">Country</div>
        {% for code, label in countries %}
            <input id="{{ code }}" class="country-input" type="checkbox" data-type="countries" data-value="{{ code }}"
            {% if code in selected_countries %}checked{% endif %}>
            <label for="{{ code }}" class="country-label" data-value="{{ code }}">{{ label }}</label>
        {% endfor %}
    </div>
    <div class="category-selector selector" id="category-selector">
        <div class="title">Category</div>
        {% for category in categories %}
            <input id="{{ category }}" class="category-input" type="checkbox" data-type="categories" data-value="{{ category }}"
            {% if category in selected_categories %}checked{% endif %}>
            <label for="{{ category }}" class="category-label" data-value="{{ category }}">{{ category }}</label>
        {% endfor %}
    </div>
    <div class="source-selector selector" id="source-selector">
        <div class="title">Source</div>
        {% for source in sources %}
            <input id="{{ source.api_id }}" class="source-input" type="checkbox" data-type="sources" data-value="{{ source.api_id }}"
            {% if source.api_id in selected_sources %}checked{% endif %}>
            <label for="{{ source.api_id }}" class="source-label" data-value="{{ source.api_id }}">{{ source.name }}</label>
        {% endfor %}
    </div>
</div>

<div class="fetch-log">
    <div class="title">Fetch Logs</div>
    {% for fetchRun in fetchRuns %}
    <div>{{ fetchRun.started_at }}</div>
    <div>{{ fetchRun.finished_at }}</div>
    <div>{{ fetchRun.duration_seconds }}</div>
    <div>{{ fetchRun.endpoint }}</div>
    <div>{{ fetchRun.params }}</div>
    <div>{{ fetchRun.api_calls }}</div>
    <div>{{ fetchRun.fetched }}</div>
    <div>{{ fetchRun.saved }}</div>
    <div>{{ fetchRun.updated }}</div>
    <div>{{ fetchRun.status }}</div>
    <div>{{ fetchRun.error }}</div>
    {% endfor %}
</div>


{% endblock %}


{% block scripts %}
    <script src="{% static 'main/js/update_globalFetchPreferences.js' %}" defer></script>
{% endblock %}

    error = models.TextField(blank=True)

    def duration_seconds(self):
        if self.finished_at:
            return (self.finished_at - self.started_at).total_seconds()
        return None

    def __str__(self):
        return f"{self.endpoint} @ {self.started_at:%Y-%m-%d %H:%M}"